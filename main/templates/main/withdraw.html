{% extends "main/base.html" %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Withdraw Funds</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f8ff; /* Soft blue background */
            color: #333;
            font-family: 'Segoe UI', sans-serif;
        }
        .withdraw-container {
            background-color: #ffffff; /* Soft white card */
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 60px auto;
        }
        .withdraw-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .method-option {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: 0.3s;
            cursor: pointer;
        }
        .method-option:hover {
            background-color: #e6f0ff;
            border-color: #007bff;
        }
        .method-option img {
            max-height: 50px;
            margin-bottom: 10px;
        }
        .btn-withdraw {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            border: none;
            padding: 10px 30px;
            border-radius: 8px;
        }
        .btn-withdraw:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="withdraw-container">
        <div class="withdraw-header">
            <h3>Withdraw Your Earnings</h3>
            <p>Select your preferred payment method</p>
        </div>

        <div class="row g-4">
            <div class="col-md-6">
                <div class="method-option" onclick="selectMethod('Khalti')">
                    <img src="{% static 'Khalti.jpg' %}" alt="Khalti Logo">
                    <div>Khalti</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="method-option" onclick="selectMethod('eSewa')">
                    <img src="{% static 'Esewa.png' %}" alt="eSewa Logo">
                    <div>eSewa</div>
                </div>
            </div>
        </div>

        <form action="#" method="POST" class="mt-4">
            {% csrf_token %}
            <input type="hidden" name="method" id="selected-method">
            <div class="mb-3">
                <label for="number" class="form-label">Enter Wallet Number</label>
                <input type="text" name="number" id="number" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="amount" class="form-label">Enter Amount (Rs)</label>
                <input type="number" name="amount" id="amount" class="form-control" required>
            </div>
            <div class="text-center">
                <button id="payment-button" type="submit" class="btn btn-withdraw">Confirm Withdraw</button>
            </div>
        </form>
    </div>

    <script>
        function selectMethod(method) {
            document.getElementById("selected-method").value = method;
            alert("Selected Method: " + method);
        }
    </script>
    

<script src="https://khalti.com/static/khalti-checkout.js"></script>
<script>
    var config = {
        publicKey: "your_public_key",  // Replace with your Khalti public key
        productIdentity: "unique_product_id",  // Replace with a unique identifier for the product
        productName: "Your Product Name",  // Replace with the name of your product
        productUrl: "https://your-website.com/product-url",  // Replace with the URL of your product
        paymentPreference: ["KHALTI", "EBANKING", "MOBILE_BANKING"],  // Payment methods you want to accept
        eventHandler: {
            onSuccess: function (payload) {
                // Handle the successful payment response
                fetch("/verify-khalti-payment/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": "{{ csrf_token }}"
                    },
                    body: JSON.stringify(payload)
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          alert("Payment successful!");
                      } else {
                          alert("Payment failed!");
                      }
                  });
            },
            onError: function (error) {
                alert("Payment error: " + error);
            },
            onClose: function () {
                console.log("Widget is closed");
            }
        }
    };
    var checkout = new KhaltiCheckout(config);
    document.getElementById("payment-button").onclick = function () {
        checkout.show({ amount: 1000 }); // Amount in paisa (e.g., 1000 paisa = 10.00 units)
    }
</script>
</body>
</html>
{% endblock %}
